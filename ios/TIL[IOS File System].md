# Today I Learned.

[참고자료](https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html)

## 학습내용
# File System Basics
운영체제에서 파일을 어떻게 관리할것이냐.

파일 시스템은 데이터 파일, 앱 및 운영 체제 자체와 관련된 파일의 영구 저장소를 처리합니다. 따라서 파일 시스템은 모든 프로세스에서 사용되는 기본 리소스 중 하나입니다.

APFS는 macOS, iOS, watchOS 및 tvOS의 기본 파일 시스템입니다. APFS는 iOS 10.3 이상 및 macOS High Sierra 이상에 대한 기본 파일 시스템으로 HFS+를 대체합니다. macOS는 에 설명된 대로 다양한 기타 형식을 추가로 지원합니다.

기본 형식에 관계없이 장치에 연결된 모든 디스크(물리적으로 연결되어 있거나 네트워크를 통해 간접적으로 연결되어 있음)는 단일 파일 모음을 생성하기 위한 공간을 제공합니다.

파일 수가 수백만 개일 수 있기 때문에 파일 시스템은 디렉토리를 사용하여 계층적 조직을 만듭니다.

iOS와 macOS의 기본 디렉토리 구조는 비슷하지만 각 시스템이 앱과 사용자 데이터를 구성하는 방식에는 차이가 있습니다.

파일 시스템과 상호 작용하는 코드 작성을 시작하기 전에 먼저 파일 시스템의 구성과 코드에 적용되는 규칙에 대해 약간 이해해야 합니다.

적절한 보안 권한이 없는 디렉터리에 파일을 쓸 수 없다는 기본 원칙 외에도 앱도 좋은 시민이 되어야 하며 파일을 적절한 위치에 보관해야 합니다.

파일을 넣는 정확한 위치는 플랫폼에 따라 다르지만 가장 중요한 목표는 사용자의 파일을 쉽게 검색할 수 있도록 하고 코드에서 내부적으로 사용하는 파일이 사용자의 방해가 되지 않도록 하는 것입니다.

# iOS File System

iOS 파일 시스템은 자체적으로 실행되는 앱에 맞춰져 있습니다. 시스템을 단순하게 유지하기 위해 iOS 기기 사용자는 파일 시스템에 직접 액세스할 수 없으며 앱은 이 규칙을 따라야 합니다.

### iOS Standard Directories: Where Files Reside (iOS 표준 디렉토리: 파일이 있는 위치)

보안을 위해 iOS 앱과 파일 시스템의 상호 작용은 앱의 샌드박스 디렉터리 내부 디렉터리로 제한됩니다.

새 앱을 설치하는 동안 설치 프로그램은 샌드박스 디렉토리 내에 앱에 대한 여러 컨테이너 디렉토리를 생성합니다. 각 컨테이너 디렉토리에는 특정 역할이 있습니다.

번들 컨테이너 디렉토리는 앱의 번들을 보유하는 반면 데이터 컨테이너 디렉토리는 앱과 사용자 모두에 대한 데이터를 보유합니다.

데이터 컨테이너 디렉터리는 앱이 데이터를 정렬하고 구성하는 데 사용할 수 있는 여러 하위 디렉터리로 더 나뉩니다. 앱은 런타임 시 iCloud 컨테이너와 같은 추가 컨테이너 디렉토리에 대한 액세스를 요청할 수도 있습니다.

이러한 컨테이너 디렉터리는 파일 시스템에 대한 앱의 기본 보기를 구성합니다. 그림 1-1은 앱의 샌드박스 디렉토리를 보여줍니다.

그림 1-1 자체 샌드박스 디렉터리 내에서 작동하는 iOS 앱

![](https://i.imgur.com/6Sgs0RE.png)

앱은 일반적으로 컨테이너 디렉토리 외부에 있는 파일에 액세스하거나 파일을 생성할 수 없습니다. 이 규칙의 한 가지 예외는 앱이 공개 시스템 인터페이스를 사용하여 사용자의 연락처나 음악과 같은 항목에 액세스하는 경우입니다.

이러한 경우 시스템 프레임워크는 도우미 앱을 사용하여 적절한 데이터 저장소를 읽거나 수정하는 데 필요한 파일 관련 작업을 처리합니다.

표 1-1은 샌드박스 디렉토리 내에서 더 중요한 일부 하위 디렉토리를 나열하고 의도된 용도를 설명합니다.

이 표는 또한 각 하위 디렉토리에 대한 추가 액세스 제한을 설명하고 해당 디렉토리의 콘텐츠가 iTunes 및 iCloud에 의해 백업되는지 여부를 나타냅니다.

### Appname.app
- 이것은 앱의 번들입니다. 이 디렉토리에는 앱과 모든 리소스가 포함되어 있습니다.
- 이 디렉토리에 쓸 수 없습니다. 변조를 방지하기 위해 번들 디렉토리는 설치 시 서명됩니다. 이 디렉토리에 쓰기 작업을 수행하면 서명이 변경되고 앱이 실행되지 않습니다.
- 그러나 앱 번들에 저장된 모든 리소스에 대한 읽기 전용 액세스 권한을 얻을 수 있습니다.
- 이 디렉토리의 내용은 iTunes 또는 iCloud에 의해 백업되지 않습니다. 그러나 iTunes는 App Store에서 구입한 모든 앱의 초기 동기화를 수행합니다.

### Documents/
- 이 디렉토리를 사용하여 사용자 생성 콘텐츠를 저장합니다. 이 디렉토리의 내용은 파일 공유를 통해 사용자가 사용할 수 있습니다. 따라서 이 디렉토리에는 사용자에게 노출하려는 파일만 포함되어야 합니다.
- 이 디렉토리의 내용은 iTunes 및 iCloud에 의해 백업됩니다.

### Documents/Inbox
- 이 디렉터리를 사용하여 앱이 외부 엔터티에서 열도록 요청한 파일에 액세스합니다. 특히 메일 프로그램은 앱과 연결된 이메일 첨부 파일을 이 디렉토리에 배치합니다. 문서 상호 작용 컨트롤러는 파일을 저장할 수도 있습니다.
- 앱은 이 디렉터리의 파일을 읽고 삭제할 수 있지만 새 파일을 만들거나 기존 파일에 쓸 수는 없습니다. 사용자가 이 디렉터리의 파일을 편집하려고 하면 앱은 변경하기 전에 디렉터리 밖으로 파일을 자동으로 이동해야 합니다.
- 이 디렉토리의 내용은 iTunes 및 iCloud에 의해 백업됩니다.

### Library/
- 이것은 사용자 데이터 파일이 아닌 모든 파일의 최상위 디렉토리입니다.
- 일반적으로 여러 표준 하위 디렉터리 중 하나에 파일을 넣습니다. iOS 앱은 일반적으로 Application Support 및 Caches 하위 디렉토리를 사용합니다. 그러나 사용자 지정 하위 디렉터리를 만들 수 있습니다.
- 사용자에게 노출되고 싶지 않은 파일에는 라이브러리 하위 디렉토리를 사용하십시오. 앱은 사용자 데이터 파일에 이러한 디렉터리를 사용해서는 안 됩니다.
- 라이브러리 디렉토리의 내용(Caches 하위 디렉토리 제외)은 iTunes 및 iCloud에 의해 백업됩니다.

### tmp/
- 이 디렉토리를 사용하여 앱 실행 사이에 지속할 필요가 없는 임시 파일을 작성하십시오. 앱은 더 이상 필요하지 않은 파일을 이 디렉터리에서 제거해야 합니다. 하지만, 시스템은 앱이 실행되고 있지 않을 때 이 디렉토리를 제거할 수 있습니다.
- 이 디렉토리의 내용은 iTunes 또는 iCloud에 의해 백업되지 않습니다.

---
iOS 앱은 Documents, Library 및 tmp 디렉토리에 추가 디렉토리를 생성할 수 있습니다. 이 작업을 수행하면 해당 위치에 있는 파일을 더 잘 구성할 수 있습니다.

iOS 앱에서 이전 디렉토리에 대한 참조를 얻는 방법에 대한 정보는 표준 디렉토리에서 항목 찾기를 참조하십시오. 파일을 저장할 위치에 대한 정보는 앱 파일을 어디에 넣어야 하는지를 참조하십시오.

## Where You Should Put Your App’s Files(앱 파일을 어디다 넣어야 하는지)

iOS 기기의 동기화 및 백업 프로세스에 시간이 오래 걸리는 것을 방지하려면 파일을 저장할 위치를 선택하세요. 대용량 파일을 저장하는 앱은 iTunes 또는 iCloud에 백업하는 프로세스를 느리게 할 수 있습니다.

이러한 앱은 또한 사용자의 사용 가능한 저장용량을 많이 소모할 수 있습니다.

사용자가 앱을 삭제하거나 해당 앱의 데이터를 iCloud에 백업하지 않도록 유도할 수 있습니다. 이를 염두에 두고 다음 지침에 따라 앱 데이터를 저장해야 합니다.

- Documents/에 사용자 데이터를 넣습니다.
    - 사용자 데이터에는 일반적으로 사용자에게 노출할 수 있는 모든 파일(사용자가 생성, 가져오기, 삭제 또는 편집하기를 원하는 모든 파일)이 포함됩니다. 그리기 앱의 경우 사용자 데이터에는 사용자가 만들 수 있는 모든 그래픽 파일이 포함됩니다.
    - 텍스트 편집기의 경우 텍스트 파일이 포함됩니다. 비디오 및 오디오 앱에는 사용자가 나중에 보거나 듣기 위해 다운로드한 파일이 포함될 수도 있습니다.

- 앱 생성 지원 파일을 Library/Application support/ 디렉토리에 넣습니다.
    - 일반적으로 이 디렉토리에는 앱이 실행하는 데 사용하지만 사용자에게는 숨겨져 있어야 하는 파일이 포함됩니다. 이 디렉토리에는 데이터 파일, 구성 파일, 템플릿 및 앱 번들에서 로드된 리소스의 수정된 버전도 포함될 수 있습니다.

- Documents/ 및 Application Support/의 파일은 기본적으로 백업됩니다.
    - NSURLIsExcludedFromBackupKey 키를 사용하여 -[NSURL setResourceValue:forKey:error:]를 호출하여 백업에서 파일을 제외할 수 있습니다. 다시 만들거나 다운로드할 수 있는 모든 파일은 백업에서 제외해야 합니다.
    - 이는 대용량 미디어 파일에 특히 중요합니다. 응용 프로그램이 비디오 또는 오디오 파일을 다운로드하는 경우 백업에 포함되어 있지 않은지 확인하십시오.

- 임시 데이터를 tmp/ 디렉토리에 넣습니다. 임시 데이터는 장기간 유지할 필요가 없는 모든 데이터로 구성됩니다.
    - 작업이 끝나면 해당 파일을 삭제하여 사용자 장치의 공간을 계속 사용하지 않도록 하십시오.
    - 시스템은 앱이 실행되고 있지 않을 때 이러한 파일을 주기적으로 제거합니다. 따라서 앱이 종료된 후에도 지속되는 이러한 파일에 의존할 수 없습니다.

- Library/Caches/ 디렉토리에 데이터 캐시 파일을 넣습니다.
    - 캐시 데이터는 임시 데이터보다 오래 지속되어야 하지만 지원 파일만큼 오래 지속되지 않아야 하는 모든 데이터에 사용할 수 있습니다.
    - 일반적으로 애플리케이션이 제대로 작동하기 위해 캐시 데이터가 필요하지는 않지만 캐시 데이터를 사용하여 성능을 향상시킬 수 있습니다.
    - 캐시 데이터의 예로는 데이터베이스 캐시 파일 및 다운로드 가능한 임시 콘텐츠가 포함되지만 이에 국한되지 않습니다.
    - 시스템은 디스크 공간을 확보하기 위해 Caches/ 디렉토리를 삭제할 수 있으므로 앱은 필요에 따라 이러한 파일을 다시 생성하거나 다운로드할 수 있어야 합니다.

## 생각해볼것들


# iOS File System에서 각 영역의 특성은 무엇이 있는지 살펴보고,다음의 데이터는 어느 영역에 저장하는 것이 좋을지 토의해봅시다.

## iOS File System

### AppName.app

앱과 모든 리소스가 포함되어 있다.
읽기전용 (수정시 앱 실행 불가)
백업 안됨

### Documents/

이 디렉토리를 사용하여 사용자 생성 콘텐츠를 저장합니다. 이 디렉토리의 내용은 파일 공유를 통해 사용자가 사용할 수 있습니다. 따라서 이 디렉토리에는 사용자에게 노출하려는 파일만 포함되어야 합니다.

백업됨

### Documents/Inbox

메일 앱 - 한글파일 (메일/documents/Inbox에)
한글뷰어 앱 - 한글파일 보고싶으면 메일앱의 documents/Inbox에 접근. 한글파일을 편집하고 싶으면 한글파일이 여기로(한글파일/documents) 복사됨
백업됨

### Library/

- Application Support
앱이 실행하는 데 사용하지만 사용자에게는 숨겨져 있어야 하는 파일이 포함
데이터 파일, 구성 파일, 템플릿 및 앱 번들에서 로드된 리소스의 수정된 버전등
백업됨

- Caches 

반복적으로 사용되는 임시데이터
캐시를 이용한 성능항샹
시스템이 파일을 삭제할 수 있음
백업안됨

### tmp

재사용되지 않는 임시데이터
임시 파일을 저장
앱이 실행중이 아닐때, 시스템에서 이 폴더내의 파일을 지울 수 있음
백업 안됨

#### tmp 와 Caches 의 차이점
- Caches 
임시저장해서 빨리빨리 다시 꺼내쓰기 위함 
더빠른곳과 덜빠른곳의 속도차를 맞춰주기 위해? 사용되기도 한다.

- tmp
쓰레기
진짜 잠깐 저장했다가 안쓰는것들

## 다음의 데이터는 어느 영역에 저장하는 것이 좋을지??
결론은 앱을 제작할때 정책에 따라 다르며 정답은 없다.
임시 파일들을 시간이지나면 자동으로 지워지게 한다거나 지우기전까지 남겨둔다거나 등등 정책에 따라 달라진다.

1. 동영상 플레이어의 동영상 파일
Documents: 사용자가 생성하거나/ 사용자에게 노출하려는 파일

2. 웹 서버에서 받아온 임시 데이터
tmp: 다시 사용안한다면 이녀석
Caches: 다시 사용한다면 요거

3. 사용자가 작성한 임시 메모
Documents: 어쨋든 사용자가 생성한 파일 
Library/Application Support ??

4. 메모장 앱의 코어데이터 저장소
코어데이터: 데이터베이스라고 볼 수 있음 - 사용자 접근 막아야할 것
Library/Application Support 여기로~

Library: 앱이 실행되는데 필요하지만 사용자에겐 감춰져야 하기 때문
앱이름.app: 사용자가 편집할 수 없는 모든 리소스가 이곳에 포함되기 때문

5. 내 일기를 외부로 내보내기 위한 백업파일
내일기앱/Documents/Inbox
속에 일기백업파일이 존재

6. 채팅 앱의 대화내역
Documents: 사용자가 생성한 파일
Library: 사용자가 생성하지 않은 파일이므로

7. 어젯밤 술취해 남겨둔 음성메모
Documents: 사용자가 생성한 파일

8. 사진편집을 위해 사진첩에서 가져온 사진
Documents: 사진/documents/inbox에서 사진을 가져와서, 자신의 documents에 저장
